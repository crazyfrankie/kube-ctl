// Code generated by Wire. DO NOT EDIT.

//go:generate go run -mod=mod github.com/google/wire/cmd/wire
//go:build !wireinject
// +build !wireinject

package ioc

import (
	"github.com/crazyfrankie/kube-ctl/docs"
	"github.com/crazyfrankie/kube-ctl/internal/api/k8s"
	"github.com/crazyfrankie/kube-ctl/internal/api/mw"
	"github.com/crazyfrankie/kube-ctl/internal/service"
	"github.com/gin-gonic/gin"
	"github.com/swaggo/files"
	"github.com/swaggo/gin-swagger"
	"k8s.io/client-go/kubernetes"
	"k8s.io/client-go/tools/clientcmd"
)

// Injectors from wire.go:

func InitServer() *gin.Engine {
	clientset := InitKubernetes()
	podService := service.NewPodService(clientset)
	podHandler := k8s.NewPodHandler(podService)
	v := InitMws()
	engine := InitGin(podHandler, v)
	return engine
}

// wire.go:

func InitKubernetes() *kubernetes.Clientset {
	kubeConfig := ".kube/config"

	config, err := clientcmd.BuildConfigFromFlags("", kubeConfig)
	if err != nil {
		panic(err.Error())
	}

	clientSet, err := kubernetes.NewForConfig(config)
	if err != nil {
		panic(err.Error())
	}

	return clientSet
}

func InitMws() []gin.HandlerFunc {
	return []gin.HandlerFunc{mw.CORS()}
}

func InitGin(pod *k8s.PodHandler, mws []gin.HandlerFunc) *gin.Engine {
	srv := gin.Default()
	srv.Use(mws...)
	pod.RegisterRoute(srv)

	srv.GET("/swagger/*any", ginSwagger.WrapHandler(swaggerFiles.Handler))
	docs.SwaggerInfo.
		BasePath = "/api"

	return srv
}
